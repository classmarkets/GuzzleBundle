<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ace.js"></script>

<script>
    !function() {
        document.querySelectorAll('a[class^=format-r-]').forEach(function(a) {
            a.addEventListener('click', function(e) {
                e.preventDefault();

                document.querySelectorAll(a.dataset.target).forEach(function(codeblock) {
                    codeblock.style.left = 0;
                    codeblock.style.right = 0;

                    let editor = ace.edit(codeblock.id);

                    if (document.body.classList.contains('theme-dark')) {
                        editor.setTheme('ace/theme/monokai');
                    } else {
                        editor.setTheme('ace/theme/chrome');
                    }

                    editor.setReadOnly(true);
                    editor.setShowPrintMargin(false);
                    editor.setOptions({maxLines: 50});

                    if (codeblock.classList.contains('json')) {
                        editor.getSession().setMode("ace/mode/json");
                        editor.getSession().setValue(JSON.stringify(JSON.parse(editor.getSession().getValue()), null, 4));
                    }

                    a.remove();
                });
            });
        });
    }()
</script>
