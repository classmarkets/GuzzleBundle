<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ace.js"></script>

<script>
    !function() {
        var formatLinks = document.querySelectorAll('a[class^=format-r-]');
        for (var i = 0; i < formatLinks.length; i++) {
            formatLinks[i].addEventListener('click', function(e) {
                e.preventDefault();
                var a = e.target;

                var targets = document.querySelectorAll(a.dataset.target);

                for (var ii = 0; ii < targets.length; ii++) {
                    var codeblock = targets[ii];

                    codeblock.style.left = 0;
                    codeblock.style.right = 0;

                    var editor = ace.edit(codeblock.id);

                    editor.setTheme('ace/theme/chrome');
                    editor.setReadOnly(true);
                    editor.setShowPrintMargin(false);
                    editor.setOptions({maxLines: 50});

                    if (codeblock.classList.contains('json')) {
                        editor.getSession().setMode("ace/mode/json");
                        editor.getSession().setValue(JSON.stringify(JSON.parse(editor.getSession().getValue()), null, 4));
                    }
                }
            });
        }
    }()
</script>
